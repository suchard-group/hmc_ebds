<?xml version="1.0" standalone="yes"?>

<!-- Generated by BEAUTi v1.10.5 Prerelease #23570d1                         -->
<!--       by Alexei J. Drummond, Andrew Rambaut and Marc A. Suchard         -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       David Geffen School of Medicine, University of California, Los Angeles-->
<!--       http://beast.community/                                           -->
<beast version="1.10.5">
	

	<!-- The list of taxa to be analysed (can also include dates/ages).          -->
	<!-- ntax=502                                                                -->

    <taxa id="taxa" dataType="nucleotide">
        <taxon id="t11"/>
        <taxon id="t18"/>
        <taxon id="t16"/>
        <taxon id="t14"/>
        <taxon id="t17"/>
        <taxon id="t13"/>
        <taxon id="t3"/>
        <taxon id="t2"/>
        <taxon id="t10"/>
        <taxon id="t8"/>
        <taxon id="t15"/>
        <taxon id="t12"/>
        <taxon id="t4"/>
        <taxon id="t6"/>
        <taxon id="t7"/>
        <taxon id="t1"/>
        <taxon id="t5"/>
        <taxon id="t19"/>
        <taxon id="t20"/>
        <taxon id="t9"/>
    </taxa>




    <newick id="startingTree" usingHeights="true" usingDates="false">
        ((((t11:0.8641994423,t18:0.3814671613):0.4114163885,(((t16:0.3575752497,((t14:0.3182420341,t17:0.3182420341):0.01093999737,(t13:0.03985986191,(t3:0.01233510867,t2:0.01233510867):0.02752475324):0.4893221696):0.02839321824):1.726270654,(t10:1.603290191,((t8:0.767209846,t15:0.767209846):0.003754593468,t12:0.7709644394):0.832325752):0.4805557119):0.4960886775,t4:1.799444726):0.06564977701):0.3759823431,(t6:1.476839488,t7:0.761632051):0.3564629451):0.5048065127,(t1:1.174430679,((t5:0.8866569232,(t19:0.4089892434,t20:0.582627463):0.3040294603):0.9069244592,t9:0.6479911683):1.011262744):0.7215290876):0.2533003474;
	</newick>

	


	<!-- Generate a tree model                                                   -->
	<treeModel id="treeModel">
		<newick idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>


	<newBirthDeathSerialSampling id="bdss" units="years" hasFinalSample="false" conditionOnSurvival="false">
		<birthRate>
			<parameter id="bdss.birthRate" value="73.74503" dimension="5" lower="0.0"/>
		</birthRate>
		<deathRate>
			<parameter id="bdss.deathRate" value="4.321" dimension="5" lower="0.0"/>
		</deathRate>
		<samplingRate>
			<parameter id="bdss.samplingRate" value="1.234" dimension="5" lower="0.0"/>
		</samplingRate>
		<treatmentProbability>
			<parameter id="bdss.treatmentProbability" value="1.0" dimension="5" lower="0.0" upper="1.0"/>
		</treatmentProbability>
        <samplingProbability>
            <compoundParameter id="bdss.samplingProbability">
                <parameter id="samplingAtPresent" value="0.3" dimension="1" lower="0.0" upper="1.0"/>
                <parameter id="otherSampling" value="0" dimension="4" lower="0.0" upper="1.0"/>
            </compoundParameter>
        </samplingProbability>
		<origin>
			<parameter id="bdss.origin" value="4.726373" lower="0.0"/>
		</origin>
		<cutOff>
			<parameter value="4.726373"/>
		</cutOff>
		<numGridPoints>
			<parameter value="5"/>
		</numGridPoints>
	</newBirthDeathSerialSampling>




    <speciationLikelihood id="speciation" useNewLoop="true">
        <model>
            <birthDeathSerialSampling idref="bdss"/>
        </model>
        <speciesTree>
            <treeModel idref="treeModel"/>
        </speciesTree>
    </speciationLikelihood>

    <compoundGradient id="grad.bdssIncrements.likelihood">
        <speciationLikelihoodGradient wrtParameter="birthRate" useNewLoop="true">
            <speciationLikelihood idref="speciation"/>
            <treeModel idref="treeModel"/>
        </speciationLikelihoodGradient>
    </compoundGradient>


   <birthDeathCompoundParameterLogger id="effectiveReproductiveNumber" compoundParameterType = "effectiveReproductiveNumber">
	   <newBirthDeathSerialSampling idref="bdss"/>
   </birthDeathCompoundParameterLogger>

	<!-- Define operators                                                        -->
    <operators id="operators" optimizationSchedule="power">
<!--        <hamiltonianMonteCarloOperator weight="1" nSteps="15" stepSize="0.01" mode="vanilla"-->
<!--                                       drawVariance="1.0" autoOptimize="true" targetAcceptanceProbability="0.7"-->
<!--                                       gradientCheckCount="0"-->
<!--                                       preconditioningUpdateFrequency="3" preconditioningDelay="0">-->
<!--            <speciationLikelihoodGradient idref="grad.bdssIncrements.likelihood"/>-->
<!--        </hamiltonianMonteCarloOperator>-->
        		<randomWalkOperator windowSize="1.0" weight="10.0">
            		<parameter idref="bdss.birthRate"/>
        		</randomWalkOperator>
    </operators>
	

	<!-- Define MCMC                                                             -->
	<mcmc id="mcmc" chainLength="100000" fullEvaluation="0" autoOptimize="true" operatorAnalysis="Odesa_withSTREAM.ops">
		<!-- <joint id="joint"> -->
			<!-- <prior id="prior">
				<multivariateDistributionLikelihood idref="bdss.birthRatePrior"/>
                <multivariateDistributionLikelihood idref="bdss.deathRatePrior"/>
				<multivariateDistributionLikelihood idref="bdss.samplingRatePrior"/>
				<truncated lower="0.0">
					<normalPrior mean="1.89" stdev="1">
						<parameter idref="bdss.origin"/>
					</normalPrior>
				</truncated>
			</prior> -->
			<likelihood id="likelihood">
                <speciationLikelihood idref="speciation"/>
			</likelihood>
		<!-- </joint> -->
		<operators idref="operators"/>

		<!-- write log to screen                                                     -->
		<log id="screenLog" logEvery="1000">
			<!-- <column label="Joint" dp="4" width="12">
				<joint idref="joint"/>
			</column>
			<column label="Prior" dp="4" width="12">
				<prior idref="prior"/>
			</column> -->
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood"/>
			</column>
			<column label="rootHeight" sf="6" width="12">
				<parameter idref="treeModel.rootHeight"/>
			</column>
		</log>

		<!-- write log to file                                                       -->
		<log id="fileLog1" logEvery="2000" fileName="ebola_500.log" overwrite="false">
			<!-- <joint idref="joint"/>
			<prior idref="prior"/> -->
			<likelihood idref="likelihood"/>
			<parameter idref="treeModel.rootHeight"/>
            <parameter idref="bdss.birthRate"/>
			<parameter idref="bdss.deathRate"/>
			<parameter idref="bdss.samplingRate"/>
			<parameter idref="bdss.origin"/>
            <birthDeathCompoundParameterLogger idref="effectiveReproductiveNumber"/>
			<speciationLikelihood idref="speciation"/>
		</log>
	</mcmc>
	
	<report>
		<property name="timer">
			<mcmc idref="mcmc"/>
		</property>
	</report>

	<report>
		<speciationLikelihood idref="speciation"/>
	</report>
</beast>
