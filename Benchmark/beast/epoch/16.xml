<?xml version="1.0" standalone="yes"?>

<!-- Generated by BEAUTi v1.10.5 Prerelease #23570d1                         -->
<!--       by Alexei J. Drummond, Andrew Rambaut and Marc A. Suchard         -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       David Geffen School of Medicine, University of California, Los Angeles-->
<!--       http://beast.community/                                           -->
<beast version="1.10.5">
	

	<!-- The list of taxa to be analysed (can also include dates/ages).          -->
	<!-- ntax=502                                                                -->

    <taxa id="taxa" dataType="nucleotide">
        <taxon id="t11"/>
        <taxon id="t3"/>
        <taxon id="t2"/>
        <taxon id="t10"/>
        <taxon id="t8"/>
        <taxon id="t12"/>
        <taxon id="t4"/>
        <taxon id="t6"/>
        <taxon id="t7"/>
        <taxon id="t1"/>
        <taxon id="t5"/>
        <taxon id="t9"/>
    </taxa>




    <newick id="startingTree" usingHeights="true" usingDates="false">
        (t1:1.421497712,((((t4:0.2360622269,t2:0.2360622269):0.2394253948,t3:0.4754876218):0.5446362896,(t11:0.01926726785,t9:0.01926726785):1.000856644):0.06167736355,((t6:0.3196766204,t10:0.3196766204):0.01318604126,(t8:0.05716595062,(t12:0.06394508958,(t5:0.02277640376,t7:0.02277640376):0.04116868582):0.493220861):0.275696711):0.7489386133):0.3396964374):1.808080789;
	</newick>
	


	<!-- Generate a tree model                                                   -->
	<treeModel id="treeModel">
		<newick idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>


	<newBirthDeathSerialSampling id="bdss" units="years" hasFinalSample="false" conditionOnSurvival="false">
		<birthRate>
			<parameter id="bdss.birthRate" value="73.74503" dimension="16" lower="0.0"/>
		</birthRate>
		<deathRate>
			<parameter id="bdss.deathRate" value="4.321" dimension="16" lower="0.0"/>
		</deathRate>
		<samplingRate>
			<parameter id="bdss.samplingRate" value="1.234" dimension="16" lower="0.0"/>
		</samplingRate>
		<treatmentProbability>
			<parameter id="bdss.treatmentProbability" value="1.0" dimension="16" lower="0.0" upper="1.0"/>
		</treatmentProbability>
        <samplingProbability>
            <compoundParameter id="bdss.samplingProbability">
                <parameter id="samplingAtPresent" value="0.3" dimension="1" lower="0.0" upper="1.0"/>
                <parameter id="otherSampling" value="0" dimension="15" lower="0.0" upper="1.0"/>
            </compoundParameter>
        </samplingProbability>
		<origin>
			<parameter id="bdss.origin" value="4.726373" lower="0.0"/>
		</origin>
		<cutOff>
			<parameter value="4.726373"/>
		</cutOff>
		<numGridPoints>
			<parameter value="16"/>
		</numGridPoints>
	</newBirthDeathSerialSampling>




    <speciationLikelihood id="speciation" useNewLoop="true">
        <model>
            <birthDeathSerialSampling idref="bdss"/>
        </model>
        <speciesTree>
            <treeModel idref="treeModel"/>
        </speciesTree>
    </speciationLikelihood>

    <compoundGradient id="grad.bdssIncrements.likelihood">
        <speciationLikelihoodGradient wrtParameter="birthRate" useNewLoop="true">
            <speciationLikelihood idref="speciation"/>
            <treeModel idref="treeModel"/>
        </speciationLikelihoodGradient>
    </compoundGradient>


   <birthDeathCompoundParameterLogger id="effectiveReproductiveNumber" compoundParameterType = "effectiveReproductiveNumber">
	   <newBirthDeathSerialSampling idref="bdss"/>
   </birthDeathCompoundParameterLogger>

	<!-- Define operators                                                        -->
    <operators id="operators" optimizationSchedule="power">
<!--        <hamiltonianMonteCarloOperator weight="1" nSteps="15" stepSize="0.01" mode="vanilla"-->
<!--                                       drawVariance="1.0" autoOptimize="true" targetAcceptanceProbability="0.7"-->
<!--                                       gradientCheckCount="0"-->
<!--                                       preconditioningUpdateFrequency="3" preconditioningDelay="0">-->
<!--            <speciationLikelihoodGradient idref="grad.bdssIncrements.likelihood"/>-->
<!--        </hamiltonianMonteCarloOperator>-->
        		<randomWalkOperator windowSize="1.0" weight="10.0">
            		<parameter idref="bdss.birthRate"/>
        		</randomWalkOperator>
    </operators>
	

	<!-- Define MCMC                                                             -->
	<mcmc id="mcmc" chainLength="100000" fullEvaluation="0" autoOptimize="true" operatorAnalysis="Odesa_withSTREAM.ops">
		<!-- <joint id="joint"> -->
			<!-- <prior id="prior">
				<multivariateDistributionLikelihood idref="bdss.birthRatePrior"/>
                <multivariateDistributionLikelihood idref="bdss.deathRatePrior"/>
				<multivariateDistributionLikelihood idref="bdss.samplingRatePrior"/>
				<truncated lower="0.0">
					<normalPrior mean="1.89" stdev="1">
						<parameter idref="bdss.origin"/>
					</normalPrior>
				</truncated>
			</prior> -->
			<likelihood id="likelihood">
                <speciationLikelihood idref="speciation"/>
			</likelihood>
		<!-- </joint> -->
		<operators idref="operators"/>

		<!-- write log to screen                                                     -->
		<log id="screenLog" logEvery="1000">
			<!-- <column label="Joint" dp="4" width="12">
				<joint idref="joint"/>
			</column>
			<column label="Prior" dp="4" width="12">
				<prior idref="prior"/>
			</column> -->
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood"/>
			</column>
			<column label="rootHeight" sf="6" width="12">
				<parameter idref="treeModel.rootHeight"/>
			</column>
		</log>

		<!-- write log to file                                                       -->
		<log id="fileLog1" logEvery="2000" fileName="ebola_500.log" overwrite="false">
			<!-- <joint idref="joint"/>
			<prior idref="prior"/> -->
			<likelihood idref="likelihood"/>
			<parameter idref="treeModel.rootHeight"/>
            <parameter idref="bdss.birthRate"/>
			<parameter idref="bdss.deathRate"/>
			<parameter idref="bdss.samplingRate"/>
			<parameter idref="bdss.origin"/>
            <birthDeathCompoundParameterLogger idref="effectiveReproductiveNumber"/>
			<speciationLikelihood idref="speciation"/>
		</log>
	</mcmc>
	
	<report>
		<property name="timer">
			<mcmc idref="mcmc"/>
		</property>
	</report>

	<report>
		<speciationLikelihood idref="speciation"/>
	</report>
</beast>
